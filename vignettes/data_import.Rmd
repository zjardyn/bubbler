---
title: "1. Data import"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{data_import}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## Introduction to `bubbler`

Denoised amplicon count datasets can be generated by various means, thus `bubbler` has various data import methods.  I designed `bubbler` to work alongside other common microbial ecology analysis tools (phyloseq, qiime2, DADA2, vegan, ape, etc), with it's main purpose being to simplify and add functionality to community composition visualization.   \n   


`bubbler` generates relative_abundance tables in `tibble::tibble` format. This format was chosen because it fits into the `tidyverse` ecosystem, which was used to develop the majority of this package. Generated tables can be modified by passing them to arranging, pooling, subsampling, etc, functions, which will return a modified table. Using the `magrittr::%>%` pipe, you can string together multiple functions to create the desired visualization. Here I provide examples for the first and arguable most important step: importing the data. 

```{r setup, echo=FALSE}
library(bubbler)
```

## QIIME2 - .qza

[qiime2](https://qiime2.org/) asv-table and taxonomy artifacts (.qza), and optionally, the qiime-formatted metadata (.tsv) can be imported. Here, `bubbler::rel_abund_qiime` is using data from the "Moving Pictures" Qiime2 [tutorial](https://docs.qiime2.org/2024.5/tutorials/moving-pictures/).

```{r}
# path to qiime-formatted asv counts 
counts_q <- system.file("extdata", "qiime", "table-dada2.qza", package = "bubbler")
# path to qiime-formatted taxonomy data 
taxa_q <- system.file("extdata", "qiime", "taxonomy.qza", package = "bubbler")
# path to qiime-formatted metadata
metadata_q <- system.file("extdata", "qiime", "sample-metadata.tsv", package = "bubbler")

# make a relative abundance table 
rel_abund_qiime(counts_q, taxa_q, metadata_q)
```

## DADA2 - .tsv

DADA2 denoises .fastq files to generate ASV count tables and ASV taxonomic classifications. Normally, I export these as .tsv files. `bubbler::rel_abund_tsv` expects to see an asv-table with ASVs as columns and samples as rows (wide format), and a taxonomy table with taxonomic levels as columns and ASVs as rows. 

```{r}
# path to asv counts in tab-separated format
counts <- system.file("extdata", "tsv", "seqtab.tsv", package = "bubbler")
# path to taxonomy data in tab-separated format
taxa <- system.file("extdata", "tsv", "taxa.tsv", package = "bubbler")
# path to metadata in tab-seperated format 
metadata <- system.file("extdata", "tsv", "metadata.tsv", package = "bubbler")

# make a relative abundance table
rel_abund_tsv(counts, taxa, metadata)
```

## Phyloseq - phyloseq R object

If you are analyzing your data through the `phyloseq` package, the `phyloseq` object can be imported as well, as long as it contains an otu_table, tax_table, and optionally, sam_data.

```{r}
# example phyloseq
rel_abund_phy(physeq, taxa_data = TRUE, meta_data = TRUE)
```


## Kracken2/Bracken - .txt

The .txt files from a [Bracken](https://github.com/jenniferlu717/Bracken) workflow can be imported.


```{r}
# path to bracken-formatted .txt files
path <- system.file("extdata", "bracken", package = "bubbler")

rel_abund_bracken(path)
```

